import base64
exec(base64.b64decode("IyEvdXNyL2Jpbi9weXRob24zCiMtKi1jb2Rpbmc6dXRmLTgtKi0KIyBNYWRlIFdpdGgg4p2k77iPIEthY2hpCgppbXBvcnQgcmVxdWVzdHMsbWVjaGFuaXplLHN1YnByb2Nlc3MsYnM0LHN5cyxvcyxzdWJwcm9jZXNzLHV1aWQscmFuZG9tLHRpbWUscmUsYmFzZTY0LGNvbmN1cnJlbnQuZnV0dXJlcyxqc29uLGlwYWRkcmVzcwpmcm9tIHJhbmRvbSBpbXBvcnQgcmFuZGludApmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yIGFzIFRocmVhZFBvb2wKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpjdXJyZW50ID0gZGF0ZXRpbWUubm93KCkKYSA9IGN1cnJlbnQuc3RyZnRpbWUoIiVBIikKaWYgYSA9PSAiU2F0dXJkYXkiOgogICAgZXhpdCgpCgpwID0gIlx4MWJbMDszN20iICMgcHV0aWgKbSA9ICJceDFiWzA7MzFtIiAjIG1lcmFoCmggPSAiXHgxYlswOzMybSIgIyBoaWphdQprID0gIlx4MWJbMDszMW0iICMga3VuaW5nCmIgPSAiXHgxYlswOzM0bSIgIyBiaXJ1CnUgPSAiXHgxYlswOzM1bSIgIyB1bmd1Cm8gPSAiXHgxYlswOzM2bSIgIyBiaXJ1IG11ZGEKCmlmICgibGludXgiIGluIHN5cy5wbGF0Zm9ybS5sb3dlcigpKToKCiAgICAgICAgTiA9ICJcMDMzWzBtIgogICAgICAgIEcgPSAiXDAzM1sxOzkybSIKICAgICAgICBPID0gIlwwMzNbMTs5N20iCiAgICAgICAgUiA9ICJcMDMzWzE7OTFtIgplbHNlOgoKICAgICAgICBOID0gIiIKICAgICAgICBHID0gIiIKICAgICAgICBPID0gIiIKICAgICAgICBSID0gIiIKCiMjIyBIRUFERVJTICMjIwoKZGVmIGJhbm5lcigpOgogICAgcHJpbnQoIiIiClwwMzNbMDszMW0uIyMuLi4uIyMuLi4uIyMjLi4uLi4jIyMjIyMuLiMjLi4uLi4jIy4jIyMjClwwMzNbMDszNW0uIyMuLi4jIy4uLi4jIy4jIy4uLiMjLi4uLiMjLiMjLi4uLi4jIy4uIyMuClwwMzNbMDszNm0uIyMuLiMjLi4uLiMjLi4uIyMuLiMjLi4uLi4uLiMjLi4uLi4jIy4uIyMuClwwMzNbMDszNG0uIyMjIyMuLi4uIyMuLi4uLiMjLiMjLi4uLi4uLiMjIyMjIyMjIy4uIyMuClwwMzNbMDszN20uIyMuLiMjLi4uIyMjIyMjIyMjLiMjLi4uLi4uLiMjLi4uLi4jIy4uIyMuClwwMzNbMDszM20uIyMuLi4jIy4uIyMuLi4uLiMjLiMjLi4uLiMjLiMjLi4uLi4jIy4uIyMuICAgICAgICAgXDAzM1sxOzM3OzQwbUZvcmNlIDIuMOKEogpcMDMzWzA7MzJtLiMjLi4uLiMjLiMjLi4uLi4jIy4uIyMjIyMjLi4jIy4uLi4uIyMuIyMjIyAKXDAzM1szNzsxbVtcMDMzWzQxOzFtIEZBQ0VCT09LIEFDQ09VTlQgSEFDS0lORyBcMDMzWzAwOzFtXDAzM1szNzsxbSBdXG4KXDAzM1sxOzM3OzQwbeKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkApcMDMzWzE7Mzc7NDBt4pSCIMKuIFNjcmlwdCBCeSBLYWNoaSDCriB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwwMzNbMzI7MW1WZXJzaW9uXDAzM1szNzsxbTpcMDMzWzMzOzFtMS4wClwwMzNbMTszNzs0MG3ilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgKXDAzM1szNzsxbVtcMDMzWzQxOzFtSUYgRlVUVVJFIE5PIEJSSUdIVCBXRSBHTyBPTiBUT1JDSFwwMzNbMDA7MW1cMDMzWzM3OzFtIF1cbgoKaG9zdD0iaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tIgpvayA9IFtdCmNwID0gW10KdHRsID1bXQoKZHVyYXNpID0gc3RyKGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlZC0lbS0lWSIpKQp0YWh1biA9IGN1cnJlbnQueWVhcgpidWxhbiA9IGN1cnJlbnQubW9udGgKaGFyaSA9IGN1cnJlbnQuZGF5CgpNQVhfSVBWNCA9IGlwYWRkcmVzcy5JUHY0QWRkcmVzcy5fQUxMX09ORVMgICMgMiAqKiAzMiAtIDEKTUFYX0lQVjYgPSBpcGFkZHJlc3MuSVB2NkFkZHJlc3MuX0FMTF9PTkVTICAjIDIgKiogMTI4IC0gMQoKZGVmIHJhbmRvbV9pcHY0KCk6CglyZXR1cm4gIGlwYWRkcmVzcy5JUHY0QWRkcmVzcy5fc3RyaW5nX2Zyb21faXBfaW50KHJhbmRvbS5yYW5kaW50KDAsIE1BWF9JUFY0KSkKZGVmIHJhbmRvbV9pcHY2KCk6CglyZXR1cm4gaXBhZGRyZXNzLklQdjZBZGRyZXNzLl9zdHJpbmdfZnJvbV9pcF9pbnQocmFuZG9tLnJhbmRpbnQoMCwgTUFYX0lQVjYpKQoKZGVmIGphbGFuKHopOgoJZm9yIGUgaW4geiArICJcbiI6CgkJc3lzLnN0ZG91dC53cml0ZShlKQoJCXN5cy5zdGRvdXQuZmx1c2goKQoJCXRpbWUuc2xlZXAoMC4wMykKCmRlZiBjbGVhcigpOgoJaWYgIiBsaW51eCIgaW4gc3lzLnBsYXRmb3JtLmxvd2VyKCk6CgkJb3Muc3lzdGVtKCJjbGVhciIpCgllbGlmICJ3aW4iIGluIHN5cy5wbGF0Zm9ybS5sb3dlcigpOgoJCW9zLnN5c3RlbSgiY2xzIikKCWVsc2U6b3Muc3lzdGVtKCJjbGVhciIpCiAgICAKZGVmIGxhbmcoY29va2llcyk6CglmPUZhbHNlCglycj1iczQuQmVhdXRpZnVsU291cChyZXF1ZXN0cy5nZXQoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sYW5ndWFnZS5waHAiLGhlYWRlcnM9aGRjb2soKSxjb29raWVzPWNvb2tpZXMpLnRleHQsImh0bWwucGFyc2VyIikKCWZvciBpIGluIHJyLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgoJCWlmICJpZF9JRCIgaW4gaS5nZXQoImhyZWYiKToKCQkJcmVxdWVzdHMuZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vIitpLmdldCgiaHJlZiIpLGNvb2tpZXM9Y29va2llcyxoZWFkZXJzPWhkY29rKCkpCgkJCWI9cmVxdWVzdHMuZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vcHJvZmlsZS5waHAiLGhlYWRlcnM9aGRjb2soKSxjb29raWVzPWNvb2tpZXMpLnRleHQJCgkJCWlmICJhcGEgeWFuZyBhbmRhIHBpa2lya2FuIHNla2FyYW5nIiBpbiBiLmxvd2VyKCk6CgkJCQlmPVRydWUKCWlmIGY9PVRydWU6CgkJcmV0dXJuIFRydWUKCWVsc2U6CgkJZXhpdCgiWyFdIFdyb25nIENvb2tpZXMiKQoKZGVmIGJhc2Vjb29raWUoKToKCWlmIG9zLnBhdGguZXhpc3RzKCIuY29rIik6CgkJaWYgb3MucGF0aC5nZXRzaXplKCIuY29rIikgIT0wOgoJCQlyZXR1cm4gZ2V0c19kaWN0X2Nvb2tpZXMob3BlbignLmNvaycpLnJlYWQoKS5zdHJpcCgpKQoJCWVsc2U6bG9ncygpCgllbHNlOmxvZ3MoKQoKZGVmIGhkY29rKCk6CglnbG9iYWwgaG9zdAoJaG9zdHM9aG9zdAoJcj17Im9yaWdpbiI6IGhvc3RzLCAiYWNjZXB0LWxhbmd1YWdlIjogImlkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43IiwgImFjY2VwdC1lbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlIiwgImFjY2VwdCI6ICJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44IiwgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzZbRkJBTi9FTUE7RkJMQy9pdF9JVDtGQkFWLzIzOS4wLjAuMTAuMTA5O10iLCAiSG9zdCI6ICIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoIjovLyguKj8pJCIsaG9zdHMpKSwgInJlZmVyZXIiOiBob3N0cysiL2xvZ2luLz9uZXh0JnJlZj1kYmwmZmwmcmVmaWQ9OCIsICJjYWNoZS1jb250cm9sIjogIm1heC1hZ2U9MCIsICJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIjogIjEiLCAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCJ9CglyZXR1cm4gcgoKZGVmIGdldHNfY29va2llcyhjb29raWVzKToKCXJlc3VsdD1bXQoJZm9yIGkgaW4gZW51bWVyYXRlKGNvb2tpZXMua2V5cygpKToKCQlpZiBpWzBdPT1sZW4obGlzdChjb29raWVzLmtleXMoKSkpLTE6cmVzdWx0LmFwcGVuZChpWzFdKyI9Iitjb29raWVzW2lbMV1dKQoJCWVsc2U6cmVzdWx0LmFwcGVuZChpWzFdKyI9Iitjb29raWVzW2lbMV1dKyI7ICIpCglyZXR1cm4gIiIuam9pbihyZXN1bHQpCgpkZWYgZ2V0c19kaWN0X2Nvb2tpZXMoY29va2llcyk6CglyZXN1bHQ9e30KCXRyeToKCQlmb3IgaSBpbiBjb29raWVzLnNwbGl0KCI7Iik6CgkJCXJlc3VsdC51cGRhdGUoe2kuc3BsaXQoIj0iKVswXTppLnNwbGl0KCI9IilbMV19KQoJCXJldHVybiByZXN1bHQKCWV4Y2VwdDoKCQlmb3IgaSBpbiBjb29raWVzLnNwbGl0KCI7ICIpOgoJCQlyZXN1bHQudXBkYXRlKHtpLnNwbGl0KCI9IilbMF06aS5zcGxpdCgiPSIpWzFdfSkKCQlyZXR1cm4gcmVzdWx0CgpkZWYgY291bnRyeSgpOgogICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICBiYW5uZXIoKQogICAgcHJpbnQoIlxuJXNbJXMgQ2hvb3NlIENvdW50cnkgJXNdXG4iJShrLHAsaykpCiAgICBwcmludCgiJXPilZEgWyVzMSVzXSAlc05pZ2VyaWEiJShrLHAsayxwKSkKICAgIHByaW50KCIlc+KVkSBbJXMyJXNdICVzQmFuZ2xhZGVzaC9JbmRpYSIlKGsscCxrLHApKQogICAgcHJpbnQoIiVz4pWRIFslczMlc10gJXNQYWtpc3RhbiIlKGsscCxrLHApKQogICAgcHJpbnQoIiVz4pWRIFslczQlc10gJXNVU0EiJShrLHAsayxwKSkKICAgIHByaW50KCIlc+KVkSBbJXMwJXNdICVzTm9uZSIlKGsscCxrLHApKQogICAgY2hvb3NlX2NvdW50cnkoKQogICAgCmRlZiBjaG9vc2VfY291bnRyeSgpOgogICAgY2MgPSBpbnB1dCgiXG4lc+KVmuKVkOKVkCBbJXPigKIlc10gJXNDaG9vc2UgOiAiJShrLHAsayxwKSkKICAgIGlmIGNjIGluWyIiXToKICAgICAgICBwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgRmlsbCBJbiBUaGUgQ29ycmVjdCIpKQogICAgZWxpZiBjYyBpblsiMSIsIjAxIl06CiAgICAgICAgb3Muc3lzdGVtKCJybSAtcmYgY291bnRyeS50eHQiKQogICAgICAgIGNvdSA9ICJpZCIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN0cnkgPSBvcGVuKCdjb3VudHJ5LnR4dCcsJ3cnKQogICAgICAgICAgICBjdHJ5LndyaXRlKGNvdSkKICAgICAgICAgICAgY3RyeS5jbG9zZSgpCiAgICAgICAgICAgIG1lbnUoKQogICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICBtZW51KCkKICAgIGVsaWYgY2MgaW5bIjIiLCIwMiJdOgogICAgICAgIG9zLnN5c3RlbSgicm0gLXJmIGNvdW50cnkudHh0IikKICAgICAgICBjb3UgPSAiYmQiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdHJ5ID0gb3BlbignY291bnRyeS50eHQnLCd3JykKICAgICAgICAgICAgY3RyeS53cml0ZShjb3UpCiAgICAgICAgICAgIGN0cnkuY2xvc2UoKQogICAgICAgICAgICBtZW51KCkKICAgICAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgbWVudSgpCiAgICBlbGlmIGNjIGluWyIzIiwiMDMiXToKICAgICAgICBvcy5zeXN0ZW0oInJtIC1yZiBjb3VudHJ5LnR4dCIpCiAgICAgICAgY291ID0gInBrIgogICAgICAgIHRyeToKICAgICAgICAgICAgY3RyeSA9IG9wZW4oJ2NvdW50cnkudHh0JywndycpCiAgICAgICAgICAgIGN0cnkud3JpdGUoY291KQogICAgICAgICAgICBjdHJ5LmNsb3NlKCkKICAgICAgICAgICAgbWVudSgpCiAgICAgICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgIG1lbnUoKQogICAgZWxpZiBjYyBpblsiNCIsIjA0Il06CiAgICAgICAgb3Muc3lzdGVtKCJybSAtcmYgY291bnRyeS50eHQiKQogICAgICAgIGNvdSA9ICJ1cyIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN0cnkgPSBvcGVuKCdjb3VudHJ5LnR4dCcsJ3cnKQogICAgICAgICAgICBjdHJ5LndyaXRlKGNvdSkKICAgICAgICAgICAgY3RyeS5jbG9zZSgpCiAgICAgICAgICAgIG1lbnUoKQogICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICBtZW51KCkKICAgIGVsaWYgY2MgaW5bIjAiLCIwMCJdOgogICAgICAgIG9zLnN5c3RlbSgicm0gLXJmIGNvdW50cnkudHh0IikKICAgICAgICBjb3UgPSAiICIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN0cnkgPSBvcGVuKCdjb3VudHJ5LnR4dCcsJ3cnKQogICAgICAgICAgICBjdHJ5LndyaXRlKGNvdSkKICAgICAgICAgICAgY3RyeS5jbG9zZSgpCiAgICAgICAgICAgIG1lbnUoKQogICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICBtZW51KCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKCiMjIyBMT0dJTiBNRVRIT0RFICMjIwoKZGVmIGxvZ3MoKToKICBvcy5zeXN0ZW0oImNsZWFyIikKICBiYW5uZXIoKQogIHByaW50KChrKyJcbuKVkSBbIitwKyIxIitrKyJdIitwKyIgTG9naW4gVG9rZW4iKSkKICBwcmludCgoaysi4pWRIFsiK3ArIjIiK2srIl0iK3ArIiBMb2dpbiBDb29raWVzIikpCiAgcHJpbnQoKGsrIuKVkSBbIitwKyIwIitrKyJdIitwKyIgRXhpdCIpKQogIHNlaz1pbnB1dChrKyJcbuKVkSBbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQogIGlmIHNlaz09IiI6CiAgICBwcmludCgoaysiXG7ilZrilZDilZAgWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKICAgIGxvZ3MoKQogIGVsaWYgc2VrPT0iMSI6CiAgICBkZWZhdWx0dWEoKQogICAgbG9nX3Rva2VuKCkKICBlbGlmIHNlaz09IjIiOgogICAgZGVmYXVsdHVhKCkKICAgIGdlbigpCiAgZWxpZiBzZWs9PSIwIjoKICAgIGV4aXQoKQogIGVsc2U6CiAgICBwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgRmlsbCBJbiBUaGUgQ29ycmVjdCIpKQogICAgbG9ncygpCgpkZWYgbG9nX3Rva2VuKCk6CiAgICBvcy5zeXN0ZW0oImNsZWFyIikKICAgIGJhbm5lcigpCiAgICB0b2tldCA9IGlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgVG9rZW4gOiAiKQogICAgdHJ5OgogICAgICAgIG90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWU/YWNjZXNzX3Rva2VuPSIgKyB0b2tldCkKICAgICAgICBhID0ganNvbi5sb2FkcyhvdHcudGV4dCkKICAgICAgICBuYW1hID0gYVsibmFtZSJdCiAgICAgICAgemVkZCA9IG9wZW4oImxvZ2luLnR4dCIsICJ3IikKICAgICAgICB6ZWRkLndyaXRlKHRva2V0KQogICAgICAgIHplZGQuY2xvc2UoKQogICAgICAgIHByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIExvZ2luIFN1Y2Nlc3NmdWwiKSkKICAgICAgICBwcmludCgoaysiXG5bInArcCLigKIiK2srIl0iK3ArIiBwbGVhc2Ugc3Vic2NyaWJlIG15IGNoYW5lbAogICAgICAgIG9zLnN5c3RlbSgneGRnLW9wZW4gaHR0cHM6Ly95b3V0dWJlLmNvbS9jaGFubmVsL1VDaHU0SlhOYzc2Z0x1ZVJOMzNLV3d0QScpCiAgICAgICAgYm90X2ZvbGxvdygpCiAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBUb2tlbiBJbnZhbGlkIikpCiAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgbG9ncygpCgpkZWYgZ2VuKCk6CiAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgYmFubmVyKCkKICAgICAgICBjb29raWUgPSBpbnB1dChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIENvb2tpZXMgOiAiKQogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGEgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vY29tcG9zZXIvb2NlbG90L2FzeW5jX2xvYWRlci8/cHVibGlzaGVyPWZlZWQjXz1fIiwgaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICJ1c2VyLWFnZW50IiAgICAgICAgICAgICAgICA6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvOTQuMC40NjA2LjgxIFNhZmFyaS81MzcuMzYgRWRnLzk0LjAuOTkyLjUwIiwgIyBPbnllZGlrYWNoaSBPa29yby4KICAgICAgICAgICAgICAgICJyZWZlcmVyIiAgICAgICAgICAgICAgICAgICA6ICJodHRwczovL20uZmFjZWJvb2suY29tLyIsCiAgICAgICAgICAgICAgICAiaG9zdCIgICAgICAgICAgICAgICAgICAgICAgOiAibS5mYWNlYm9vay5jb20iLAogICAgICAgICAgICAgICAgIm9yaWdpbiIgICAgICAgICAgICAgICAgICAgIDogImh0dHBzOi8vbS5mYWNlYm9vay5jb20iLAogICAgICAgICAgICAgICAgInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiIDogIjEiLAogICAgICAgICAgICAgICAgImFjY2VwdC1sYW5ndWFnZSIgICAgICAgICAgIDogImlkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43IiwKICAgICAgICAgICAgICAgICJjYWNoZS1jb250cm9sIiAgICAgICAgICAgICA6ICJtYXgtYWdlPTAiLAogICAgICAgICAgICAgICAgImFjY2VwdCIgICAgICAgICAgICAgICAgICAgIDogInRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLAogICAgICAgICAgICAgICAgImNvbnRlbnQtdHlwZSIgICAgICAgICAgICAgIDogInRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIKICAgICAgICAgICAgICAgIH0sIGNvb2tpZXMgPSB7CiAgICAgICAgICAgICAgICAiY29va2llIiAgICAgICAgICAgICAgICAgICAgOiBjb29raWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBmaW5kX3Rva2VuID0gcmUuc2VhcmNoKCIoRUFBQVx3KykiLCBkYXRhLnRleHQpCiAgICAgICAgICAgICAgICBoYXNpbCAgICA9ICJcbiogRmFpbCA6IG1heWJlIHlvdXIgY29va2llIGludmFsaWQgISEiIGlmIChmaW5kX3Rva2VuIGlzIE5vbmUpIGVsc2UgIlxuKiBZb3VyIGZiIGFjY2VzcyB0b2tlbiA6ICIgKyBmaW5kX3Rva2VuLmdyb3VwKDEpCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBObyBDb25uZWN0aW9uIikpCiAgICAgICAgZXhjZXB0IFtLZXlFcnJvcixJT0Vycm9yXToKICAgICAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBDb29raWVzIEludmFsaWQiKSkKICAgICAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgICAgIGxvZ3MoKQogICAgICAgIGNvb2tpZSA9IG9wZW4oImxvZ2luLnR4dCIsICJ3IikKICAgICAgICBjb29raWUud3JpdGUoZmluZF90b2tlbi5ncm91cCgxKSkKICAgICAgICBjb29raWUuY2xvc2UoKQogICAgICAgIHByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIExvZ2luIFN1Y2Nlc3NmdWwiKSkKICAgICAgICBib3RfZm9sbG93KCkKCiMjIyBCT1QgRk9MTE9XICMjIyBPa29ybyBPbnllZGlrYWNoaSBQcm9zcGVyICEhIQoKZGVmIGJvdF9mb2xsb3coKToKCXRyeToKCQl0b2tldD1vcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCgkJb3R3ID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS8/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJYSA9IGpzb24ubG9hZHMob3R3LnRleHQpCgkJbmFtYSA9IGFbIm5hbWUiXQoJCWlkID0gYVsiaWQiXQoJZXhjZXB0IElPRXJyb3I6CgkJcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIFRva2VuIEludmFsaWQiKSkKCQlsb2dzKCkKCWphbGFuKCIlc1slc+KAoiVzXSAlc1BsZWFzZSBXYWl0Li4uIiUoayxwLGsscCkpCglyZXF1ZXN0cy5wb3N0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwNjE5Njg1NDM5NzYvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPSIgKyB0b2tldCkgICAgICAjIG93bmVyIGFjY291bnQKCXJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzEwMDA2MTk2ODU0Mzk3Ni9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49IiArIHRva2V0KSAgICAgICMgQWRtaW4KCgltZW51KCkKCiMjIyBNQUlOIE1FTlUgIyMjCgpkZWYgbWVudSgpOgogICAgdHJ5OgogICAgICAgIHRva2V0ID0gb3BlbigibG9naW4udHh0IiwiciIpLnJlYWQoKQogICAgICAgIG90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2V0KQogICAgICAgIGEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQogICAgICAgIG5hbWEgPSBhWyJuYW1lIl0KICAgICAgICBpZCA9IGFbImlkIl0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkpCiAgICAgICAgbG9ncygpCiAgICBpcCA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikudGV4dAogICAgbmdyID0gb3BlbignY291bnRyeS50eHQnLCAncicpLnJlYWQoKQogICAgaWYgIm5nIiBpbiBuZ3I6CiAgICAgICAgbmVnYXJhID0gIk5pZ2VyaWEiCiAgICBlbGlmICJiZCIgaW4gbmdyOgogICAgICAgIG5lZ2FyYSA9ICJCYW5nbGFkZXNoL0luZGlhIgogICAgZWxpZiAicGsiIGluIG5ncjoKICAgICAgICBuZWdhcmEgPSAiUGFraXN0YW4iCiAgICBlbGlmICJ1cyIgaW4gbmdyOgogICAgICAgIG5lZ2FyYSA9ICJVU0EiCiAgICBlbGlmICIgIiBpbiBuZ3I6CiAgICAgICAgbmVnYXJhID0gIk5vbmUiCiAgICBvcy5zeXN0ZW0oImNsZWFyIikKICAgIGJhbm5lcigpCiAgICBwcmludCgoaysiXG5bICIrcCsiV2VsY29tZSAiK2FbIm5hbWUiXStrKyIgXSIrcCkpCiAgICBwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBZb3VyIElEIDogIitpZCkpCiAgICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgWW91ciBJUCA6ICIraXApKQogICAgcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFN0YXR1cyAgOiAiK28rIlB1YmxpYyIrcCkpCiAgICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgSm9pbmVkICA6ICIrZHVyYXNpKSkKICAgIHByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayAgIDogIituZWdhcmEpKQogICAgcHJpbnQoKGsrIlxu4pWRIFsiK3ArIjEiK2srIl0iK3ArIiBDcmFjayBJRCBGcm9tIFB1YmxpYy9GcmllbmQiKSkKICAgIHByaW50KChrKyLilZEgWyIrcCsiMiIraysiXSIrcCsiIENyYWNrIElEIEZyb20gRm9sbG93ZXJzIikpCiAgICBwcmludCgoaysi4pWRIFsiK3ArIjMiK2srIl0iK3ArIiBDcmFjayBJRCBGcm9tIExpa2VycyBQb3N0IikpCiAgICBwcmludCgoaysi4pWRIFsiK3ArIjQiK2srIl0iK3ArIiBDcmFjayBCeSBQaG9uZSBOdW1iZXIiKSkKICAgIHByaW50KChrKyLilZEgWyIrcCsiNSIraysiXSIrcCsiIENyYWNrIEJ5IEVtYWlsIikpCiAgICBwcmludCgoaysi4pWRIFsiK3ArIjYiK2srIl0iK3ArIiBHZXQgRGF0YSBUYXJnZXQiKSkKICAgIHByaW50KChrKyLilZEgWyIrcCsiNyIraysiXSIrcCsiIFJlc3VsdCBDcmFjayIpKQogICAgcHJpbnQoKGsrIuKVkSBbIitwKyI4IitrKyJdIitwKyIgVXNlciBBZ2VudCIpKQogICAgcHJpbnQoKGsrIuKVkSBbIitwKyIwIitrKyJdIitwKyIgTG9nb3V0IikpCiAgICBjaG9vc2VfbWVudSgpCgpkZWYgY2hvb3NlX21lbnUoKToKICAgIAoJcj1pbnB1dChrKyJcbuKVmuKVkOKVkCBbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJaWYgcj09IiI6CgkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBGaWxsIEluIFRoZSBDb3JyZWN0IikpCgkJbWVudSgpCgllbGlmIHI9PSIxIjoKCQlwdWJsaWsoKQoJZWxpZiByPT0iMiI6CgkJZm9sbG93KCkKCWVsaWYgcj09IjMiOgoJCWxpa2VycygpCgllbGlmIHI9PSI0IjoKCQlyYW5kb21fbnVtYmVycygpCgllbGlmIHI9PSI1IjoKCQlyYW5kb21fZW1haWwoKQoJZWxpZiByPT0iNiI6CgkJdGFyZ2V0KCkKCWVsaWYgcj09IjciOgoJCXJlc3MoKQoJZWxpZiByPT0iOCI6CgkJbWVudV91c2VyX2FnZW50KCkKCWVsaWYgcj09IjAiOgoJCXRyeToKCQkJamFsYW4oaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBUaGFua3MgRm9yIFVzaW5nIE15IFNjcmlwdCIpCgkJCW9zLnN5c3RlbSgicm0gLXJmIGxvZ2luLnR4dCIpCgkJCW9zLnN5c3RlbSgidGVybXV4LW9wZW4tdXJsIGh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9vbnllZGlrYWNoaS5va29yby4zNzYwIikKCQkJZXhpdCgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIEVycm9yICVzIiVlKSkKCWVsc2U6CgkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBXcm9uZyBJbnB1dCIpKQoJCW1lbnUoKQkKCmRlZiBwaWxpaGNyYWNrKGZpbGUpOgogIHByaW50KChrKyJcbuKVkSBbIitwKyIxIitrKyJdIitwKyIgQXBpICgiK2srIkZhc3QiK3ArIikiKSkKICBwcmludCgoaysi4pWRIFsiK3ArIjIiK2srIl0iK3ArIiBBcGkgKyBUVEwgKCIraysiRmFzdCIrcCsiKSIpKQogIHByaW50KChrKyLilZEgWyIrcCsiMyIraysiXSIrcCsiIE1iYXNpYyAoIitrKyJTbG93IitwKyIpIikpCiAgcHJpbnQoKGsrIuKVkSBbIitwKyI0IitrKyJdIitwKyIgTWJhc2ljICsgVFRMICgiK2srIlNsb3ciK3ArIikiKSkKICBwcmludCgoaysi4pWRIFsiK3ArIjUiK2srIl0iK3ArIiBGcmVlIEZhY2Vib29rICgiK2srIlN1cGVyIFNsb3ciK3ArIikiKSkKICBrcmFoPWlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ2hvb3NlIDogIikKICBpZiBrcmFoIGluWyIiXToKICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgRmlsbCBJbiBUaGUgQ29ycmVjdCIpKQogICAgcGlsaWhjcmFjayhmaWxlKQogIGVsaWYga3JhaCBpblsiMSIsIjAxIl06CiAgICBiYXBpKGZpbGUpCiAgZWxpZiBrcmFoIGluWyIyIiwiMDIiXToKICAgIGJhcGl0dGwoZmlsZSkKICBlbGlmIGtyYWggaW5bIjMiLCIwMyJdOgogICAgY3JhY2soZmlsZSkKICBlbGlmIGtyYWggaW5bIjQiLCIwNCJdOgogICAgY3JhY2t0dGwoZmlsZSkKICBlbGlmIGtyYWggaW5bIjUiLCIwNSJdOgogICAgY3JhY2tmZmIoZmlsZSkKICBlbHNlOgogICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBGaWxsIEluIFRoZSBDb3JyZWN0IikpCiAgICBwaWxpaGNyYWNrKGZpbGUpCgojIyMgRFVNUCBJRCAjIyMKCmRlZiBwdWJsaWsoKToKCXRyeToKCQl0b2tldD1vcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCglleGNlcHQgSU9FcnJvcjoKCQlwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgQ29va2llL1Rva2VuIEludmFsaWQiKSkKCQlvcy5zeXN0ZW0oInJtIC1yZiBsb2dpbi50eHQiKQoJCWxvZ3MoKQoJdHJ5OgoJCXByaW50KChrKyJcbuKVkSBbIitwKyLigKIiK2srIl0iK3ArIiBUeXBlIFwnbWVcJyBUbyBEdW1wIEZyb20gRnJpZW5kbGlzdCIpKQoJCWlkdCA9IGlucHV0KGsrIuKVkSBbIitwKyLigKIiK2srIl0iK3ArIiBVc2VyIElEIFRhcmdldCA6ICIpCgkJdHJ5OgoJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIE5hbWUgOiAiK29wWyJuYW1lIl0pKQoJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBJRCBOb3QgRm91bmQiKSkKCQkJcHJpbnQoKGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKSkKCQkJcHVibGlrKCkKCQlyPXJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIi9mcmllbmRzP2xpbWl0PTEwMDAwJmFjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWlkID0gW10KCQl6PWpzb24ubG9hZHMoci50ZXh0KQoJCXFxID0gKG9wWyJmaXJzdF9uYW1lIl0rIi5qc29uIikucmVwbGFjZSgiICIsIl8iKQoJCXlzID0gb3BlbihxcSAsICJ3IikjLnJlcGxhY2UoIiAiLCJfIikKCQlmb3IgYSBpbiB6WyJkYXRhIl06CgkJCWlkLmFwcGVuZChhWyJpZCJdKyI8PT4iK2FbIm5hbWUiXSkKCQkJeXMud3JpdGUoYVsiaWQiXSsiPD0+IithWyJuYW1lIl0rIlxuIikKCQl5cy5jbG9zZSgpCgkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIElEIDogJXMiJShsZW4oaWQpKSkpCgkJcmV0dXJuIHBpbGloY3JhY2socXEpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJZXhpdChrKyJbIitwKyIhIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkKCmRlZiBmb2xsb3coKToKCXRyeToKCQl0b2tldD1vcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCglleGNlcHQgSU9FcnJvcjoKCQlwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgQ29va2llL1Rva2VuIEludmFsaWQiKSkKCQlvcy5zeXN0ZW0oInJtIC1yZiBsb2dpbi50eHQiKQoJCWxvZ3MoKQoJdHJ5OgoJCWlkdCA9IGlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgRm9sbG93ZXJzIElEIFRhcmdldCA6ICIpCgkJdHJ5OgoJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIE5hbWUgOiAiK29wWyJuYW1lIl0pKQoJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBJRCBOb3QgRm91bmQiKSkKCQkJcHJpbnQoKGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKSkKCQkJcHVibGlrKCkKCQlyPXJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIi9zdWJzY3JpYmVycz9saW1pdD0yMDAwMCZhY2Nlc3NfdG9rZW49Iit0b2tldCkKCQlpZCA9IFtdCgkJej1qc29uLmxvYWRzKHIudGV4dCkKCQlxcSA9IChvcFsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKCQl5cyA9IG9wZW4ocXEgLCAidyIpIy5yZXBsYWNlKCIgIiwiXyIpCgkJZm9yIGEgaW4gelsiZGF0YSJdOgoJCQlpZC5hcHBlbmQoYVsiaWQiXSsiPD0+IithWyJuYW1lIl0pCgkJCXlzLndyaXRlKGFbImlkIl0rIjw9PiIrYVsibmFtZSJdKyJcbiIpCgkJeXMuY2xvc2UoKQoJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBUb3RhbCBJRCA6ICVzIiUobGVuKGlkKSkpKQoJCXJldHVybiBwaWxpaGNyYWNrKHFxKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWV4aXQoaysiWyIrcCsiISIraysiXSIrcCsiIEVycm9yIDogJXMiJWUpCgpkZWYgbGlrZXJzKCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigibG9naW4udHh0IiwiciIpLnJlYWQoKQoJZXhjZXB0IElPRXJyb3I6CgkJcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIENvb2tpZS9Ub2tlbiBJbnZhbGlkIikpCgkJb3Muc3lzdGVtKCJybSAtcmYgbG9naW4udHh0IikKCQlsb2dzKCkKCXRyeToKCQlpZHQgPSBpbnB1dChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIElEIFBvc3QgVGFyZ2V0IDogIikKCQl0cnk6CgkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgTmFtZSA6ICIrb3BbIm5hbWUiXSkpCgkJZXhjZXB0IEtleUVycm9yOgoJCQlwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIElEIE5vdCBGb3VuZCIpKQoJCQlwcmludCgoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApKQoJCQlwdWJsaWsoKQoJCXI9cmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL2xpa2VzP2xpbWl0PTEwMDAwMCZhY2Nlc3NfdG9rZW49Iit0b2tldCkKCQlpZCA9IFtdCgkJej1qc29uLmxvYWRzKHIudGV4dCkKCQlxcSA9IChvcFsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKCQl5cyA9IG9wZW4ocXEgLCAidyIpIy5yZXBsYWNlKCIgIiwiXyIpCgkJZm9yIGEgaW4gelsiZGF0YSJdOgoJCQlpZC5hcHBlbmQoYVsiaWQiXSsiPD0+IithWyJuYW1lIl0pCgkJCXlzLndyaXRlKGFbImlkIl0rIjw9PiIrYVsibmFtZSJdKyJcbiIpCgkJeXMuY2xvc2UoKQoJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBUb3RhbCBJRCA6ICVzIiUobGVuKGlkKSkpKQoJCXJldHVybiBwaWxpaGNyYWNrKHFxKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWV4aXQoaysiWyIrcCsiISIraysiXSIrcCsiIEVycm9yIDogJXMiJWUpCgojIyMgQ1JBQ0sgRU1BSUwgJiBQSE9ORSAjIyMKCmRlZiByYW5kb21fbnVtYmVycygpOgogIGRhdGEgPSBbXQogIHByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIE51bWJlciBNdXN0IEJlIDUgRGlnaXQiKSkKICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXhhbXBsZSA6IDkyMDM3IikpCiAga29kZT1zdHIoaW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgSW5wdXQgTnVtYmVyIDogIikpCiAgZXhpdCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgTnVtYmVyIE11c3QgQmUgNSBEaWdpdCIpKSBpZiBsZW4oa29kZSkgPCA1IGVsc2UgJycKICBleGl0KChrKyJcblsiK3ArIiEiK2srIl0iK3ArIiBOdW1iZXIgTXVzdCBCZSA1IERpZ2l0IikpIGlmIGxlbihrb2RlKSA+IDUgZWxzZSAnJwogIGptbD1pbnQoaW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgQW1vdW50IDogIikpCiAgW2RhdGEuYXBwZW5kKHsndXNlcic6IHN0cihlKSwgJ3B3Jzpbc3RyKGVbNTpdKSwgc3RyKGVbNjpdKV19KSBmb3IgZSBpbiBbc3RyKGtvZGUpKycnLmpvaW4oWyclcyclKHJhbmRpbnQoMCw5KSkgZm9yIGkgaW4gcmFuZ2UoMCw3KV0pIGZvciBlIGluIHJhbmdlKGptbCldXQogIHByaW50KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZCwgUGxlYXNlIFdhaXQuLi5cbiIpCiAgd2l0aCBjb25jdXJyZW50LmZ1dHVyZXMuVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTE1KSBhcyB0aDoKICAgIHt0aC5zdWJtaXQoYnJ1dGUsIHVzZXJbJ3VzZXInXSwgdXNlclsncHcnXSk6IHVzZXIgZm9yIHVzZXIgaW4gZGF0YX0KICBpbnB1dChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkKICBtZW51KCkKCmRlZiByYW5kb21fZW1haWwoKToKICBkYXRhID0gW10KICBuYW1hPWlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgVGFyZ2V0IE5hbWUgOiAiKQogIGRvbWFpbj1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgRG9tYWluIFtHXW1haWwsIFtZXWFob28sIFtIXW90bWFpbCA6ICIpLmxvd2VyKCkuc3RyaXAoKQogIGxpc3Q9ewogICAgJ2cnOidAZ21haWwuY29tJywKICAgICd5JzonQHlhaG9vLmNvbScsCiAgICAnaCc6J0Bob3RtYWlsLmNvbScKICB9CiAgZXhpdCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRmlsbCBJbiBUaGUgQ29ycmVjdCIpKSBpZiBub3QgZG9tYWluIGluIFsnZycsJ3knLCdoJ10gZWxzZSAnJwogIGptbD1pbnQoaW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgQW1vdW50IDogIikpCiAgc2V0cHc9aW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgU2V0IFBhc3N3b3JkIDogIikuc3BsaXQoJywnKQogIHByaW50KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZCwgUGxlYXNlIFdhaXQuLi5cbiIpCiAgW2RhdGEuYXBwZW5kKHsndXNlcic6IG5hbWErc3RyKGUpK2xpc3RbZG9tYWluXSwgJ3B3JzpbKGkpIGZvciBpIGluIHNldHB3XX0pIGZvciBlIGluIHJhbmdlKDEsam1sKzEpXQogIHdpdGggY29uY3VycmVudC5mdXR1cmVzLlRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz0xNSkgYXMgdGg6CiAgICB7dGguc3VibWl0KGJydXRlLCB1c2VyWyd1c2VyJ10sIHVzZXJbJ3B3J10pOiB1c2VyIGZvciB1c2VyIGluIGRhdGF9CiAgaW5wdXQoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApCiAgbWVudSgpCgpkZWYgYnJ1dGUodXNlciwgcGFzc3MpOgogIHRyeToKICAgIGZvciBwdyBpbiBwYXNzczoKICAgICAgcGFyYW1zPXsKICAgICAgICAnYWNjZXNzX3Rva2VuJzogJzM1MDY4NTUzMTcyOCU3QzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJywKICAgICAgICAnZm9ybWF0JzogJ0pTT04nLAogICAgICAgICdzZGtfdmVyc2lvbic6ICcyJywKICAgICAgICAnZW1haWwnOiB1c2VyLAogICAgICAgICdsb2NhbGUnOiAnZW5fVVMnLAogICAgICAgICdwYXNzd29yZCc6IHB3LAogICAgICAgICdzZGsnOiAnaW9zJywKICAgICAgICAnZ2VuZXJhdGVfc2Vzc2lvbl9jb29raWVzJzogJzEnLAogICAgICAgICdzaWcnOiAnM2Y1NTVmOTlmYjYxZmNkN2FhMGM0NGY1OGY1MjJlZjYnLAogICAgICB9CiAgICAgIGFwaT0naHR0cHM6Ly9iLWFwaS5mYWNlYm9vay5jb20vbWV0aG9kL2F1dGgubG9naW4nCiAgICAgIHJlc3BvbnNlPXJlcXVlc3RzLmdldChhcGksIHBhcmFtcz1wYXJhbXMpCiAgICAgIGlmIHJlLnNlYXJjaCgnKEVBQUEpXHcrJywgc3RyKHJlc3BvbnNlLnRleHQpKToKICAgICAgICBwcmludCgnXHgxYlswOzMybVtceDFiWzA7MzdtS2FjaGktT0tceDFiWzA7MzJtXSAlcyDigKIgJXMgJyUoc3RyKHVzZXIpLCBzdHIocHcpKSkKICAgICAgICBicmVhawogICAgICBlbGlmICd3d3cuZmFjZWJvb2suY29tJyBpbiByZXNwb25zZS5qc29uKClbJ2Vycm9yX21zZyddOgogICAgICAgIHByaW50KCdceDFiWzA7MzFtW1x4MWJbMDszN21LYWNoaS1DUFx4MWJbMDszMW1dICVzIOKAoiAlcyAnJShzdHIodXNlciksIHN0cihwdykpKQogICAgICAgIGJyZWFrCiAgZXhjZXB0OiBwYXNzCgojIyMgSU5GTyBBQ0NPVU5UICMjIwoKZGVmIHRhcmdldCgpOgoJdHJ5OgoJCXRva2V0PW9wZW4oImxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCWV4Y2VwdCBJT0Vycm9yOgoJCXByaW50KChrKyJcblsiK3ArIiEiK2srIl0iK3ArIiBUb2tlbiBJbnZhbGlkIikpCgkJb3Muc3lzdGVtKCJybSAtcmYgbG9naW4udHh0IikKCQlsb2dpbigpCgl0cnk6CgkJaWR0ID0gaW5wdXQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBJRCBUYXJnZXQgICAgICAgIDogIikKCQl0cnk6CgkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgTmFtZSBBY2NvdW50ICAgICA6ICIrb3BbIm5hbWUiXSkpCgkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBVc2VybmFtZSAgICAgICAgIDogIitvcFsidXNlcm5hbWUiXSkpCgkJCXRyeToKCQkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFbWFpbCAgICAgICAgICAgIDogIitvcFsiZW1haWwiXSkpCgkJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFbWFpbCAgICAgICAgICAgIDogLSIpKQoJCQl0cnk6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRGF0ZSBPZiBCaXJ0aCAgICA6ICIrb3BbImJpcnRoZGF5Il0pKQoJCQlleGNlcHQgS2V5RXJyb3I6CgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRGF0ZSBPZiBCaXJ0aCAgICA6IC0iKSkKCQkJdHJ5OgoJCQkJam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEdlbmRlciAgICAgICAgICAgOiAiK29wWyJnZW5kZXIiXSkpCgkJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBHZW5kZXIgICAgICAgICAgIDogLSIpKQoJCQl0cnk6CgkJCQlyID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL2ZyaWVuZHM/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlpZCA9IFtdCgkJCQl6ID0ganNvbi5sb2FkcyhyLnRleHQpCgkJCQlxcSA9IChvcFsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKCQkJCXlzID0gb3BlbihxcSAsICJ3IikKCQkJCWZvciBpIGluIHpbImRhdGEiXToKCQkJCQlpZC5hcHBlbmQoaVsiaWQiXSkKCQkJCQl5cy53cml0ZShpWyJpZCJdKQoJCQkJeXMuY2xvc2UoKQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIEZyaWVuZCAgICAgOiAlcyIlKGxlbihpZCkpKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIEZyaWVuZCAgICAgOiAtIikpCgkJCXRyeToKCQkJCWE9cmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL3N1YnNjcmliZXJzP2xpbWl0PTIwMDAwJmFjY2Vzc190b2tlbj0iK3Rva2V0KQoJCQkJaWQgPSBbXQoJCQkJYiA9IGpzb24ubG9hZHMoYS50ZXh0KQoJCQkJYmIgPSAob3BbImZpcnN0X25hbWUiXSsiLmpzb24iKS5yZXBsYWNlKCIgIiwiXyIpCgkJCQlqdyA9IG9wZW4oYmIgLCAidyIpCgkJCQlmb3IgYyBpbiBiWyJkYXRhIl06CgkJCQkJaWQuYXBwZW5kKGNbImlkIl0pCgkJCQkJancud3JpdGUoY1siaWQiXSkKCQkJCWp3LmNsb3NlKCkKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBUb3RhbCBGb2xsb3dlciAgIDogJXMiJShsZW4oaWQpKSkpCgkJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBUb3RhbCBGb2xsb3dlciAgIDogLSIpKQoJCQl0cnk6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgV2Vic2l0ZSAgICAgICAgICA6ICIrb3BbIndlYnNpdGUiXSkpCgkJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBXZWJzaXRlICAgICAgICAgIDogLSIpKQoJCQlleGNlcHQgSU9FcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBXZWJzaXRlICAgICAgICAgIDogLSIpKQoJCQl0cnk6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVXBkYXRlIFRpbWUgICAgICA6ICIrb3BbInVwZGF0ZWRfdGltZSJdKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFVwZGF0ZSBUaW1lICAgICAgOiAtIikpCgkJCWV4Y2VwdCBJT0Vycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFVwZGF0ZSBUaW1lICAgICAgOiAtIikpCgkJCWlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQoJCQltZW51KCkKCQlleGNlcHQgS2V5RXJyb3I6CgkJCWlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQoJCQltZW51KCkKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlleGl0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEVycm9yIDogJXMiJWUpCgojIyMgUEFTU1dPUkQgIyMjCgpkZWYgZ2VuZXJhdGUodGV4dCk6CglyZXN1bHRzPVtdCgljdCA9IG9wZW4oJ2NvdW50cnkudHh0JywgJ3InKS5yZWFkKCkKCWZvciBpIGluIHRleHQuc3BsaXQoIiAiKToKCQlpZiBsZW4oaSk8MzoKCQkJY29udGludWUKCQllbHNlOgoJCQlpPWkubG93ZXIoKQoJCQlpZiBsZW4oaSk9PTMgb3IgbGVuKGkpPT00IG9yIGxlbihpKT09NToKCQkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgkJCWVsc2U6CgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjMiKQoJCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNDUiKQoJCQkJcmVzdWx0cy5hcHBlbmQoaSkKCQkJCWlmICJuZyIgaW4gY3Q6CgkJCQkJcmVzdWx0cy5hcHBlbmQoIjIyMzM0NCIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjMzNDQ1NSIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjIzNDU2NyIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjY2Nzc4OCIpCgkJCQllbGlmICJiZCIgaW4gY3Q6CgkJCQkJcmVzdWx0cy5hcHBlbmQoIjc4Njc4NiIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjAwMDc4NiIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjEwMjAzMCIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjU1NjY3NyIpCgkJCQllbGlmICJwayIgaW4gY3Q6CgkJCQkJcmVzdWx0cy5hcHBlbmQoIjIwMzA0MCIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjc3ODg5OSIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoIjAwMDc4NiIpCgkJCQllbGlmICJ1cyIgaW4gY3Q6CgkJCQkJcmVzdWx0cy5hcHBlbmQoIjEyMzQ1NiIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoInF3ZXJ0eSIpCgkJCQkJcmVzdWx0cy5hcHBlbmQoImlsb3ZleW91IikKCQkJCQlyZXN1bHRzLmFwcGVuZCgicGFzc3dvcmRzIikKCXJldHVybiByZXN1bHRzCgojIyMgVVNFUiBBR0VOVCAjIyMKCmRlZiBkZWZhdWx0dWEoKToKICAgIHVhID0gIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85NC4wLjQ2MDYuODEgU2FmYXJpLzUzNy4zNiBFZGcvOTQuMC45OTIuNTA7XSIKICAgIHRyeToKICAgICAgICB1Z2VudCA9IG9wZW4oJ3VnZW50LnR4dCcsJ3cnKQogICAgICAgIHVnZW50LndyaXRlKHVhKQogICAgICAgIHVnZW50LmNsb3NlKCkKICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgIGxvZ3MoKQoKZGVmIG1lbnVfdXNlcl9hZ2VudCgpOgogICAgcHJpbnQoIlxuJXNbJXMxJXNdICVzR2V0IFVzZXIgQWdlbnQiJShrLHAsayxwKSkKICAgIHByaW50KCIlc1slczIlc10gJXNDaGFuZ2UgVXNlciBBZ2VudCIlKGsscCxrLHApKQogICAgcHJpbnQoIiVzWyVzMyVzXSAlc1JlbW92ZSBVc2VyIEFnZW50IiUoayxwLGsscCkpCiAgICBwcmludCgiJXNbJXM0JXNdICVzQ2hlY2sgVXNlciBBZ2VudCIlKGsscCxrLHApKQogICAgcHJpbnQoIiVzWyVzMCVzXSAlc0JhY2siJShrLHAsayxwKSkKICAgIHBpbGloX21lbnVfdXNlcl9hZ2VudCgpCgpkZWYgcGlsaWhfbWVudV91c2VyX2FnZW50KCk6CiAgICBwbXUgPSBpbnB1dCgiXG4lc+KVmuKVkOKVkCBbJXPigKIlc10gJXNDaG9vc2UgOiAiJShrLHAsayxwKSkKICAgIGlmIHBtdSBpblsiIl06CiAgICAgICAgcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKICAgIGVsaWYgcG11IGluWyIxIiwiMDEiXToKICAgICAgICBvcy5zeXN0ZW0oJ3hkZy1vcGVuIGh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vc2VhcmNoP3E9TXkrVXNlcitBZ2VudCZvcT1NeStVc2VyK0FnZW50JmFxcz1jaHJvbWUuLjY5aTU3ajBsM2owaTIyaTMwbDYuNDY3NGowajEmc291cmNlaWQ9Y2hyb21lJmllPVVURi04JykKICAgICAgICBpbnB1dChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkKICAgICAgICBtZW51KCkKICAgIGVsaWYgcG11IGluWyIyIiwiMDIiXToKICAgICAgICBjaGFuZ2VfdWdlbnQoKQogICAgZWxpZiBwbXUgaW5bIjMiLCIwMyJdOgogICAgICAgIG9zLnN5c3RlbSgicm0gLXJmIHVnZW50LnR4dCIpCiAgICAgICAgcHJpbnQoIlxuJXNbJXMhJXNdICVzVXNlciBBZ2VudCBXYXMgUmVtb3ZlZCIlKGsscCxrLHApKQogICAgICAgIGlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQogICAgICAgIG1lbnUoKQogICAgZWxpZiBwbXUgaW5bIjQiLCIwNCJdOgogICAgICAgIGNoZWNrX3VnZW50KCkKICAgIGVsaWYgcG11IGluWyIwIiwiMDAiXToKICAgICAgICBtZW51KCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKCmRlZiBjaGFuZ2VfdWdlbnQoKToKICAgIG9zLnN5c3RlbSgicm0gLXJmIHVnZW50LnR4dCIpCiAgICB1YSA9IGlucHV0KCJcbiVzWyVz4oCiJXNdICVzSW5wdXQgVXNlciBBZ2VudCA6IFxuXG4lcyIlKGsscCxrLHAsaCkpCiAgICB0cnk6CiAgICAgICAgdWdlbnQgPSBvcGVuKCd1Z2VudC50eHQnLCd3JykKICAgICAgICB1Z2VudC53cml0ZSh1YSkKICAgICAgICB1Z2VudC5jbG9zZSgpCiAgICAgICAgamFsYW4oIlxuJXNbJXPigKIlc10gJXNTdWNjZXNzIENoYW5nZWQgVXNlciBBZ2VudCIlKGgscCxoLHApKQogICAgICAgIGlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQogICAgICAgIG1lbnUoKQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgamFsYW4oIlxuJXNbJXPigKIlc10gJXNGYWlsZWQgVG8gQ2hhbmdlIFVzZXIgQWdlbnQiJShtLHAsbSxwKSkKICAgICAgICBpbnB1dChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkKICAgICAgICBtZW51KCkKCmRlZiBjaGVja191Z2VudCgpOgogICAgdHJ5OgogICAgICAgIHVuZ3NlciA9IG9wZW4oJ3VnZW50LnR4dCcsICdyJykucmVhZCgpCiAgICBleGNlcHQgSU9FcnJvcjoKICAgICAgICB1bmdzZXIgPSAoIiVzWyVzISVzXSAlc1VzZXIgQWdlbnQgTm90IEZvdW5kIiUoayxwLGsscCkpCiAgICBleGNlcHQ6cGFzcwogICAgcHJpbnQgKCJcbiVzWyVz4oCiJXNdICVzWW91ciBVc2VyIEFnZW50IDogXG5cbiVzJXMiJShrLHAsayxwLGgsdW5nc2VyKSkKICAgIGlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQogICAgbWVudSgpCgojIyMgQlJVVEUgQ1JBQ0sgIyMjCgpkZWYgbWJhc2ljKGVtLHBhcyxob3N0cyk6Cgl1YSA9IG9wZW4oJ3VnZW50LnR4dCcsICdyJykucmVhZCgpCglyPXJlcXVlc3RzLlNlc3Npb24oKQoJci5oZWFkZXJzLnVwZGF0ZSh7Ikhvc3QiOiJtYmFzaWMuZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcifSkKCXA9ci5nZXQoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8iKQoJYj1iczQuQmVhdXRpZnVsU291cChwLnRleHQsImh0bWwucGFyc2VyIikKCW1ldGE9IiIuam9pbihiczQucmUuZmluZGFsbCgnZHRzZyI6XHsidG9rZW4iOiIoLio/KSInLHAudGV4dCkpCglkYXRhPXt9Cglmb3IgaSBpbiBiKCJpbnB1dCIpOgoJCWlmIGkuZ2V0KCJ2YWx1ZSIpIGlzIE5vbmU6CgkJCWlmIGkuZ2V0KCJuYW1lIik9PSJlbWFpbCI6CgkJCQlkYXRhLnVwZGF0ZSh7ImVtYWlsIjplbX0pCgkJCWVsaWYgaS5nZXQoIm5hbWUiKT09InBhc3MiOgoJCQkJZGF0YS51cGRhdGUoeyJwYXNzIjpwYXN9KQoJCQllbHNlOgoJCQkJZGF0YS51cGRhdGUoe2kuZ2V0KCJuYW1lIik6IiJ9KQoJCWVsc2U6CgkJCWRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOmkuZ2V0KCJ2YWx1ZSIpfSkKCWRhdGEudXBkYXRlKAoJCXsiZmJfZHRzZyI6bWV0YSwibV9zZXNzIjoiIiwiX191c2VyIjoiMCIsCgkJIl9fcmVxIjoiZCIsIl9fY3NyIjoiIiwiX19hIjoiIiwiX19keW4iOiIiLCJlbmNwYXNzIjoiIgoJCX0KCSkKCXIuaGVhZGVycy51cGRhdGUoeyJyZWZlcmVyIjoiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL2xvZ2luLz9uZXh0JnJlZj1kYmwmZmwmcmVmaWQ9OCJ9KQoJcG89ci5wb3N0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vbG9naW4vZGV2aWNlLWJhc2VkL2xvZ2luL2FzeW5jLz9yZWZzcmM9aHR0cHMlM0ElMkYlMkZtLmZhY2Vib29rLmNvbSUyRmxvZ2luJTJGJTNGcmVmJTNEZGJsJmx3dj0xMDAiLGRhdGE9ZGF0YSkudGV4dAoJaWYgImNfdXNlciIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOgoJCXJldHVybiB7InN0YXR1cyI6InN1Y2Nlc3MiLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6ci5jb29raWVzLmdldF9kaWN0KCl9CgllbGlmICJjaGVja3BvaW50IiBpbiBsaXN0KHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKSk6CgkJcmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6ci5jb29raWVzLmdldF9kaWN0KCl9CgllbHNlOnJldHVybiB7InN0YXR1cyI6ImVycm9yIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CgpkZWYgZl9mYihlbSxwYXMsaG9zdHMpOgoJdWEgPSBvcGVuKCd1Z2VudC50eHQnLCAncicpLnJlYWQoKQoJcj1yZXF1ZXN0cy5TZXNzaW9uKCkKCXIuaGVhZGVycy51cGRhdGUoeyJIb3N0IjoiZnJlZS5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50Ijp1YSwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJpZC1JRCxpZDtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNyJ9KQoJcD1yLmdldCgiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbS8iKQoJYj1iczQuQmVhdXRpZnVsU291cChwLnRleHQsImh0bWwucGFyc2VyIikKCW1ldGE9IiIuam9pbihiczQucmUuZmluZGFsbCgnZHRzZyI6XHsidG9rZW4iOiIoLio/KSInLHAudGV4dCkpCglkYXRhPXt9Cglmb3IgaSBpbiBiKCJpbnB1dCIpOgoJCWlmIGkuZ2V0KCJ2YWx1ZSIpIGlzIE5vbmU6CgkJCWlmIGkuZ2V0KCJuYW1lIik9PSJlbWFpbCI6CgkJCQlkYXRhLnVwZGF0ZSh7ImVtYWlsIjplbX0pCgkJCWVsaWYgaS5nZXQoIm5hbWUiKT09InBhc3MiOgoJCQkJZGF0YS51cGRhdGUoeyJwYXNzIjpwYXN9KQoJCQllbHNlOgoJCQkJZGF0YS51cGRhdGUoe2kuZ2V0KCJuYW1lIik6IiJ9KQoJCWVsc2U6CgkJCWRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOmkuZ2V0KCJ2YWx1ZSIpfSkKCWRhdGEudXBkYXRlKAoJCXsiZmJfZHRzZyI6bWV0YSwibV9zZXNzIjoiIiwiX191c2VyIjoiMCIsCgkJIl9fcmVxIjoiZCIsIl9fY3NyIjoiIiwiX19hIjoiIiwiX19keW4iOiIiLCJlbmNwYXNzIjoiIgoJCX0KCSkKCXIuaGVhZGVycy51cGRhdGUoeyJyZWZlcmVyIjoiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbS9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgifSkKCXBvPXIucG9zdCgiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbS9sb2dpbi9kZXZpY2UtYmFzZWQvbG9naW4vYXN5bmMvP3JlZnNyYz1odHRwcyUzQSUyRiUyRm0uZmFjZWJvb2suY29tJTJGbG9naW4lMkYlM0ZyZWYlM0RkYmwmbHd2PTEwMCIsZGF0YT1kYXRhKS50ZXh0CglpZiAiY191c2VyIiBpbiBsaXN0KHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKSk6CgkJcmV0dXJuIHsic3RhdHVzIjoic3VjY2VzcyIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KCWVsaWYgImNoZWNrcG9pbnQiIGluIGxpc3Qoci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpKToKCQlyZXR1cm4geyJzdGF0dXMiOiJjcCIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KCWVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KCmNsYXNzIGNyYWNrOgoJb3Muc3lzdGVtKCJjbGVhciIpCgliYW5uZXIoKQoJZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CgkJc2VsZi5hZGE9W10KCQlzZWxmLmNwPVtdCgkJc2VsZi5rbz0wCgkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgV2l0aCBQYXNzIERlZmF1bHQvTWFudWFsIFtkL21dIikpCgkJd2hpbGUgVHJ1ZToKCQkJZj1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJCQlpZiBmPT0iIjpjb250aW51ZQoJCQllbGlmIGY9PSJtIjoKCQkJCXRyeToKCQkJCQl3aGlsZSBUcnVlOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmFwaz1pc2lmaWxlCgkJCQkJCQlzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKCQkJCQkJCWJyZWFrCgkJCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCQkJY29udGludWUKCQkJCQlzZWxmLmZsPVtdCgkJCQkJZm9yIGkgaW4gc2VsZi5mczoKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF19KQoJCQkJCQlleGNlcHQ6Y29udGludWUKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQljb250aW51ZQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEV4YW1wbGUgOiAyMjMzNDQsMzM0NDU1LDEyMzQ1NiIpKQoJCQkJc2VsZi5wd2xpc3QoKQoJCQkJYnJlYWsKCQkJZWxpZiBmPT0iZCI6CgkJCQl0cnk6CgkJCQkJd2hpbGUgVHJ1ZToKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5hcGs9aXNpZmlsZQoJCQkJCQkJc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCgkJCQkJCQlicmVhawoJCQkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQkJCWNvbnRpbnVlCgkJCQkJc2VsZi5mbD1bXQoJCQkJCWZvciBpIGluIHNlbGYuZnM6CgkJCQkJCXRyeToKCQkJCQkJCXNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIjw9PiIpWzBdLCJwdyI6Z2VuZXJhdGUoaS5zcGxpdCgiPD0+IilbMV0pfSkKCQkJCQkJZXhjZXB0OmNvbnRpbnVlCgkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJcHJpbnQoKCIgICAlcyIlZSkpCgkJCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLi4uIitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLU9LXSBTYXZlZCB0byA6IEthY2hpLU9LLnR4dCIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1DUF0gU2F2ZWQgdG8gOiBLYWNoaS1DUC50eHRcbiIpKQoJCQkJVGhyZWFkUG9vbCgzNSkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQkJb3MucmVtb3ZlKHNlbGYuYXBrKQoJCQkJZXhpdCgpCgkJCQlicmVhawoJZGVmIHB3bGlzdChzZWxmKToKCQlzZWxmLnB3PWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFBhc3N3b3JkIExpc3QgOiAiKS5zcGxpdCgiLCIpCgkJaWYgbGVuKHNlbGYucHcpID09MDoKCQkJc2VsZi5wd2xpc3QoKQoJCWVsc2U6CgkJCWZvciBpIGluIHNlbGYuZmw6CgkJCQlpLnVwZGF0ZSh7InB3IjpzZWxmLnB3fSkKCQkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKCQkJVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQlvcy5yZW1vdmUoc2VsZi5hcGspCgkJCWV4aXQoKQoJZGVmIG1haW4oc2VsZixmbCk6CgkJdHJ5OgoJCQlmb3IgaSBpbiBmbC5nZXQoInB3Iik6CgkJCQlsb2c9bWJhc2ljKGZsLmdldCgiaWQiKSwKCQkJCQlpLCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20iKQoJCQkJaWYgbG9nLmdldCgic3RhdHVzIik9PSJjcCI6CgkJCQkJcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMxbV0gJXMg4oCiICVzICAgICAgICAgICAgICAgIiUoZmwuZ2V0KCJpZCIpLGkpKSkKCQkJCQlzZWxmLmNwLmFwcGVuZCgiJXMg4oCiICVzIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCW9wZW4oIkthY2hpLUNQLnR4dCIsImErIikud3JpdGUoIiVzIOKAoiAlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCWJyZWFrCgkJCQllbGlmIGxvZy5nZXQoInN0YXR1cyIpPT0ic3VjY2VzcyI6CgkJCQkJcHJpbnQoKCJcclx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LXHgxYlswOzMybV0gJXMg4oCiICVzICAgICAgICAgICAgICAgIiUoZmwuZ2V0KCJpZCIpLGkpKSkKCQkJCQlzZWxmLmFkYS5hcHBlbmQoIiVzIOKAoiAlcyIlKGZsLmdldCgiaWQiKSxpKSkKCQkJCQlvcGVuKCJLYWNoaS1PSy50eHQiLCJhKyIpLndyaXRlKCIlcyDigKIgJXNcbiIlKGZsLmdldCgiaWQiKSxpKSkKCQkJCQlicmVhawoJCQkJZWxzZTpjb250aW51ZQoJCQkJCQoJCQlzZWxmLmtvKz0xCgkJCXByaW50KCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUNyYWNrXHgxYlswOzMxbV1ceDFiWzA7MzdtICVzLyVzIFx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LIDogJXNceDFiWzA7MzJtXSBceDFiWzA7MzFtW1x4MWJbMDszN21LYWNoaS1DUCA6ICVzXHgxYlswOzMxbV1ceDFiWzA7MzdtIiUoc2VsZi5rbyxsZW4oc2VsZi5mbCksbGVuKHNlbGYuYWRhKSxsZW4oc2VsZi5jcCkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKCQlleGNlcHQ6CgkJCXNlbGYubWFpbihmbCkKCmNsYXNzIGNyYWNrdHRsOgoJb3Muc3lzdGVtKCJjbGVhciIpCgliYW5uZXIoKQoJZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CgkJc2VsZi5hZGE9W10KCQlzZWxmLmNwPVtdCgkJc2VsZi5rbz0wCgkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgV2l0aCBQYXNzIERlZmF1bHQvTWFudWFsIFtkL21dIikpCgkJd2hpbGUgVHJ1ZToKCQkJZj1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJCQlpZiBmPT0iIjpjb250aW51ZQoJCQllbGlmIGY9PSJtIjoKCQkJCXRyeToKCQkJCQl3aGlsZSBUcnVlOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmFwaz1pc2lmaWxlCgkJCQkJCQlzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKCQkJCQkJCWJyZWFrCgkJCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCQkJY29udGludWUKCQkJCQlzZWxmLmZsPVtdCgkJCQkJZm9yIGkgaW4gc2VsZi5mczoKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF19KQoJCQkJCQlleGNlcHQ6Y29udGludWUKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQljb250aW51ZQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEV4YW1wbGUgOiAyMjMzNDQsMzM0NDU1LDEyMzQ1NiIpKQoJCQkJc2VsZi5wd2xpc3QoKQoJCQkJYnJlYWsKCQkJZWxpZiBmPT0iZCI6CgkJCQl0cnk6CgkJCQkJd2hpbGUgVHJ1ZToKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5hcGs9aXNpZmlsZQoJCQkJCQkJc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCgkJCQkJCQlicmVhawoJCQkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQkJCWNvbnRpbnVlCgkJCQkJc2VsZi5mbD1bXQoJCQkJCWZvciBpIGluIHNlbGYuZnM6CgkJCQkJCXRyeToKCQkJCQkJCXNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIjw9PiIpWzBdLCJwdyI6Z2VuZXJhdGUoaS5zcGxpdCgiPD0+IilbMV0pfSkKCQkJCQkJZXhjZXB0OmNvbnRpbnVlCgkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJcHJpbnQoKCIgICAlcyIlZSkpCgkJCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLi4uIitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLU9LXSBTYXZlZCB0byA6IEthY2hpLU9LLnR4dCIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1DUF0gU2F2ZWQgdG8gOiBLYWNoaS1DUC50eHRcbiIpKQoJCQkJVGhyZWFkUG9vbCgzNSkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQkJb3MucmVtb3ZlKHNlbGYuYXBrKQoJCQkJZXhpdCgpCgkJCQlicmVhawoJZGVmIHB3bGlzdChzZWxmKToKCQlzZWxmLnB3PWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFBhc3N3b3JkIExpc3QgOiAiKS5zcGxpdCgiLCIpCgkJaWYgbGVuKHNlbGYucHcpID09MDoKCQkJc2VsZi5wd2xpc3QoKQoJCWVsc2U6CgkJCWZvciBpIGluIHNlbGYuZmw6CgkJCQlpLnVwZGF0ZSh7InB3IjpzZWxmLnB3fSkKCQkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKCQkJVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQlvcy5yZW1vdmUoc2VsZi5hcGspCgkJCWV4aXQoKQoJZGVmIG1haW4oc2VsZixmbCk6CgkJdHJ5OgoJCQlmb3IgaSBpbiBmbC5nZXQoInB3Iik6CgkJCQlsb2c9bWJhc2ljKGZsLmdldCgiaWQiKSwKCQkJCQlpLCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20iKQoJCQkJaWYgbG9nLmdldCgic3RhdHVzIik9PSJjcCI6CgkJCQkJdHJ5OgoJCQkJCQlrZT1yZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIrZmwuZ2V0KCJpZCIpKyI/YWNjZXNzX3Rva2VuPSIrb3BlbigibG9naW4udHh0IiwiciIpLnJlYWQoKSkKCQkJCQkJdHQ9anNvbi5sb2FkcyhrZS50ZXh0KQoJCQkJCQl0dGw9dHRbImJpcnRoZGF5Il0KCQkJCQkJcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMxbV0gJXMg4oCiICVzIOKAoiAlcyAgICAgICAgICAiJShmbC5nZXQoImlkIiksaSx0dGwpKSkKCQkJCQkJc2VsZi5jcC5hcHBlbmQoIiVzIOKAoiAlcyDigKIgJXMiJShmbC5nZXQoImlkIiksaSx0dGwpKQoJCQkJCQlvcGVuKCJLYWNoaS1DUC50eHQiLCJhKyIpLndyaXRlKCIlcyDigKIgJXMg4oCiICVzXG4iJShmbC5nZXQoImlkIiksaSx0dGwpKQoJCQkJCQlicmVhawoJCQkJCWV4Y2VwdChLZXlFcnJvciwgSU9FcnJvcik6CgkJCQkJCXR0bCA9ICIgIgoJCQkJCWV4Y2VwdDpwYXNzCgkJCQkJcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMxbV0gJXMg4oCiICVzICAgICAgICAgICAgICAgIiUoZmwuZ2V0KCJpZCIpLGkpKSkKCQkJCQlzZWxmLmNwLmFwcGVuZCgiJXMg4oCiICVzIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCW9wZW4oIkthY2hpLUNQLnR4dCIsImErIikud3JpdGUoIiVzIOKAoiAlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCWJyZWFrCgkJCQllbGlmIGxvZy5nZXQoInN0YXR1cyIpPT0ic3VjY2VzcyI6CgkJCQkJcHJpbnQoKCJcclx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LXHgxYlswOzMybV0gJXMg4oCiICVzICAgICAgICAgICAgICAgIiUoZmwuZ2V0KCJpZCIpLGkpKSkKCQkJCQlzZWxmLmFkYS5hcHBlbmQoIiVzIOKAoiAlcyIlKGZsLmdldCgiaWQiKSxpKSkKCQkJCQlvcGVuKCJLYWNoaS1PSy50eHQiLCJhKyIpLndyaXRlKCIlcyDigKIgJXNcbiIlKGZsLmdldCgiaWQiKSxpKSkKCQkJCQlicmVhawoJCQkJZWxzZTpjb250aW51ZQoJCQkJCQoJCQlzZWxmLmtvKz0xCgkJCXByaW50KCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUNyYWNrXHgxYlswOzMxbV1ceDFiWzA7MzdtICVzLyVzIFx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LIDogJXNceDFiWzA7MzJtXSBceDFiWzA7MzFtW1x4MWJbMDszN21LYWNoaS1DUCA6ICVzXHgxYlswOzMxbV1ceDFiWzA7MzdtIiUoc2VsZi5rbyxsZW4oc2VsZi5mbCksbGVuKHNlbGYuYWRhKSxsZW4oc2VsZi5jcCkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKCQlleGNlcHQ6CgkJCXNlbGYubWFpbihmbCkKCmNsYXNzIGNyYWNrZmZiOgoJb3Muc3lzdGVtKCJjbGVhciIpCgliYW5uZXIoKQoJZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CgkJc2VsZi5hZGE9W10KCQlzZWxmLmNwPVtdCgkJc2VsZi5rbz0wCgkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgV2l0aCBQYXNzIERlZmF1bHQvTWFudWFsIFtkL21dIikpCgkJd2hpbGUgVHJ1ZToKCQkJZj1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJCQlpZiBmPT0iIjpjb250aW51ZQoJCQllbGlmIGY9PSJtIjoKCQkJCXRyeToKCQkJCQl3aGlsZSBUcnVlOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmFwaz1pc2lmaWxlCgkJCQkJCQlzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKCQkJCQkJCWJyZWFrCgkJCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCQkJY29udGludWUKCQkJCQlzZWxmLmZsPVtdCgkJCQkJZm9yIGkgaW4gc2VsZi5mczoKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF19KQoJCQkJCQlleGNlcHQ6Y29udGludWUKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQljb250aW51ZQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEV4YW1wbGUgOiAyMjMzNDQsMzM0NDU1LDEyMzQ1NiIpKQoJCQkJc2VsZi5wd2xpc3QoKQoJCQkJYnJlYWsKCQkJZWxpZiBmPT0iZCI6CgkJCQl0cnk6CgkJCQkJd2hpbGUgVHJ1ZToKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5hcGs9aXNpZmlsZQoJCQkJCQkJc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCgkJCQkJCQlicmVhawoJCQkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQkJCWNvbnRpbnVlCgkJCQkJc2VsZi5mbD1bXQoJCQkJCWZvciBpIGluIHNlbGYuZnM6CgkJCQkJCXRyeToKCQkJCQkJCXNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIjw9PiIpWzBdLCJwdyI6Z2VuZXJhdGUoaS5zcGxpdCgiPD0+IilbMV0pfSkKCQkJCQkJZXhjZXB0OmNvbnRpbnVlCgkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJcHJpbnQoKCIgICAlcyIlZSkpCgkJCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLi4uIitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLU9LXSBTYXZlZCB0byA6IEthY2hpLU9LLnR4dCIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1DUF0gU2F2ZWQgdG8gOiBLYWNoaS1DUC50eHRcbiIpKQoJCQkJVGhyZWFkUG9vbCgzNSkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQkJb3MucmVtb3ZlKHNlbGYuYXBrKQoJCQkJZXhpdCgpCgkJCQlicmVhawoJZGVmIHB3bGlzdChzZWxmKToKCQlzZWxmLnB3PWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFBhc3N3b3JkIExpc3QgOiAiKS5zcGxpdCgiLCIpCgkJaWYgbGVuKHNlbGYucHcpID09MDoKCQkJc2VsZi5wd2xpc3QoKQoJCWVsc2U6CgkJCWZvciBpIGluIHNlbGYuZmw6CgkJCQlpLnVwZGF0ZSh7InB3IjpzZWxmLnB3fSkKCQkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKCQkJVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQlvcy5yZW1vdmUoc2VsZi5hcGspCgkJCWV4aXQoKQoJZGVmIG1haW4oc2VsZixmbCk6CgkJdHJ5OgoJCQlmb3IgaSBpbiBmbC5nZXQoInB3Iik6CgkJCQlsb2c9Zl9mYihmbC5nZXQoImlkIiksCgkJCQkJaSwiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbSIpCgkJCQlpZiBsb2cuZ2V0KCJzdGF0dXMiKT09ImNwIjoKCQkJCQlwcmludCgoIlxyXHgxYlswOzMxbVtceDFiWzA7MzdtS2FjaGktQ1BceDFiWzA7MzFtXSAlcyDigKIgJXMgICAgICAgICAgICAgICAiJShmbC5nZXQoImlkIiksaSkpKQoJCQkJCXNlbGYuY3AuYXBwZW5kKCIlcyDigKIgJXMiJShmbC5nZXQoImlkIiksaSkpCgkJCQkJb3BlbigiS2FjaGktQ1AudHh0IiwiYSsiKS53cml0ZSgiJXMg4oCiICVzXG4iJShmbC5nZXQoImlkIiksaSkpCgkJCQkJYnJlYWsKCQkJCWVsaWYgbG9nLmdldCgic3RhdHVzIik9PSJzdWNjZXNzIjoKCQkJCQlwcmludCgoIlxyXHgxYlswOzMybVtceDFiWzA7MzdtS2FjaGktT0tceDFiWzA7MzJtXSAlcyDigKIgJXMgICAgICAgICAgICAgICAiJShmbC5nZXQoImlkIiksaSkpKQoJCQkJCXNlbGYuYWRhLmFwcGVuZCgiJXMg4oCiICVzIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCW9wZW4oIkthY2hpLU9LLnR4dCIsImErIikud3JpdGUoIiVzIOKAoiAlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCWJyZWFrCgkJCQllbHNlOmNvbnRpbnVlCgkJCQkJCgkJCXNlbGYua28rPTEKCQkJcHJpbnQoIlxyXHgxYlswOzMxbVtceDFiWzA7MzdtQ3JhY2tceDFiWzA7MzFtXVx4MWJbMDszN20gJXMvJXMgXHgxYlswOzMybVtceDFiWzA7MzdtS2FjaGktT0sgOiAlc1x4MWJbMDszMm1dIFx4MWJbMDszMW1bXHgxYlswOzM3bUthY2hpLUNQIDogJXNceDFiWzA7MzFtXVx4MWJbMDszN20iJShzZWxmLmtvLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5hZGEpLGxlbihzZWxmLmNwKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQoJCWV4Y2VwdDoKCQkJc2VsZi5tYWluKGZsKQoKY2xhc3MgYmFwaToKICBkZWYgX19pbml0X18oc2VsZixpc2lmaWxlKToKICAgIHNlbGYuc2V0cHcgPSBGYWxzZQogICAgc2VsZi5vayA9IFtdCiAgICBzZWxmLmNwID0gW10KICAgIHNlbGYubG9vcCA9IDAKICAgIHNlbGYua3JhaChpc2lmaWxlKQogIGRlZiBrcmFoKHNlbGYsaXNpZmlsZSk6CiAgICBwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBXaXRoIFBhc3MgRGVmYXVsdC9NYW51YWwgW2QvbV0iKSkKICAgIHdoaWxlIFRydWU6CiAgICAgIGY9aW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgQ2hvb3NlIDogIikKICAgICAgaWYgZiBpblsiIiwiICJdOgogICAgICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgSW52YWxpZCBOdW1iZXIiKSkKICAgICAgICBjb250aW51ZQogICAgICBlbGlmIGYgaW5bIm0iLCJNIl06CiAgICAgICAgdHJ5OgogICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgIHNlbGYuYXBrPWlzaWZpbGUKICAgICAgICAgICAgICBzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiAlcyIlZSkpCiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIHNlbGYuZmw9W10KICAgICAgICAgIHByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFeGFtcGxlIDogMjIzMzQ0LDMzNDQ1NSwxMjM0NTYiKSkKICAgICAgICAgIHNlbGYucHc9aW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgUGFzc3dvcmQgTGlzdCA6ICIpLnNwbGl0KCIsIikKICAgICAgICAgIGlmIGxlbihzZWxmLnB3KSA9PTA6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpzZWxmLnB3fSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgcHJpbnQoKCIgICVzIiVlKSkKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKICAgICAgICBUaHJlYWRQb29sKDMwKS5tYXAoc2VsZi5icnV0ZSxzZWxmLmZsKQogICAgICAgICNvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgZXhpdCgpCiAgICAgICAgYnJlYWsKICAgICAgZWxpZiBmIGluWyJkIiwiRCJdOgogICAgICAgIHRyeToKICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICBzZWxmLmFwaz1pc2lmaWxlCiAgICAgICAgICAgICAgc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgIHByaW50KGUpCiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIHNlbGYuZmw9W10KICAgICAgICAgIGZvciBpIGluIHNlbGYuZnM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICBzZWxmLmZsLmFwcGVuZCh7ImlkIjppLnNwbGl0KCI8PT4iKVswXSwicHciOmdlbmVyYXRlKGkuc3BsaXQoIjw9PiIpWzFdKX0pCiAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKICAgICAgICBUaHJlYWRQb29sKDMwKS5tYXAoc2VsZi5icnV0ZSxzZWxmLmZsKQogICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykKICAgICAgICBleGl0KCkKICAgICAgICBicmVhawogIGRlZiBicnV0ZVJlcXVlc3Qoc2VsZiwgdXNlcm5hbWUsIHBhc3N3b3JkKToKICAgIGdsb2JhbCBvayxjcCx0dGwKICAgIHBhcmFtcyA9IHsiYWNjZXNzX3Rva2VuIjogIjM1MDY4NTUzMTcyOCU3QzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyIiwgICJmb3JtYXQiOiAiSlNPTiIsICJzZGtfdmVyc2lvbiI6ICIyIiwgImVtYWlsIjogdXNlcm5hbWUsICJsb2NhbGUiOiAiZW5fVVMiLCAicGFzc3dvcmQiOiBwYXNzd29yZCwgInNkayI6ICJpb3MiLCAiZ2VuZXJhdGVfc2Vzc2lvbl9jb29raWVzIjogIjEiLCAic2lnIjogIjNmNTU1Zjk5ZmI2MWZjZDdhYTBjNDRmNThmNTIyZWY2In0KICAgIGFwaSA9ICJodHRwczovL2ItYXBpLmZhY2Vib29rLmNvbS9tZXRob2QvYXV0aC5sb2dpbiIKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGFwaSwgcGFyYW1zPXBhcmFtcykKICAgIGlmIHJlLnNlYXJjaCgiKEVBQUEpXFx3KyIsIHJlc3BvbnNlLnRleHQpOgogICAgICBzZWxmLm9rLmFwcGVuZCh1c2VybmFtZSArICIg4oCiICIgKyBwYXNzd29yZCkKICAgICAgcHJpbnQoKCJcclx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LXHgxYlswOzMybV0gJXMg4oCiICVzICVzICAgICAgICAgICAgICAgIiUodXNlcm5hbWUscGFzc3dvcmQsTikpKQogICAgICBvay5hcHBlbmQodXNlcm5hbWUgKyAiIOKAoiAiICsgcGFzc3dvcmQpCiAgICAgIHNhdmUgPSBvcGVuKCJLYWNoaS1PSy50eHQiLCAiYSIpCiAgICAgIHNhdmUud3JpdGUoc3RyKHVzZXJuYW1lKSArICIg4oCiICIgKyBzdHIocGFzc3dvcmQpICsgIlxuIikKICAgICAgc2F2ZS5jbG9zZSgpCiAgICAgIHJldHVybiBUcnVlCiAgICBlbHNlOgogICAgICBpZiAid3d3LmZhY2Vib29rLmNvbSIgaW4gcmVzcG9uc2UuanNvbigpWyJlcnJvcl9tc2ciXToKICAgICAgICBzZWxmLmNwLmFwcGVuZCh1c2VybmFtZSArICIg4oCiICIgKyBwYXNzd29yZCkKICAgICAgICBwcmludCgoIlxyXHgxYlswOzMxbVtceDFiWzA7MzdtS2FjaGktQ1BceDFiWzA7MzFtXSAlcyDigKIgJXMgJXMgICAgICAgICAgICAgICAiJSh1c2VybmFtZSxwYXNzd29yZCxOKSkpCiAgICAgICAgc2F2ZSA9IG9wZW4oIkthY2hpLUNQLnR4dCIsICJhKyIpCiAgICAgICAgc2F2ZS53cml0ZShzdHIodXNlcm5hbWUpICsgIiDigKIgIiArIHN0cihwYXNzd29yZCkgKyAiXG4iKQogICAgICAgIHNhdmUuY2xvc2UoKQogICAgICAgIHJldHVybiBUcnVlCiAgICByZXR1cm4gRmFsc2UKICBkZWYgYnJ1dGUoc2VsZiwgZmwpOgogICAgaWYgc2VsZi5zZXRwdyA9PSBGYWxzZToKICAgICAgc2VsZi5sb29wICs9IDEKICAgICAgZm9yIHB3IGluIGZsWyJwdyJdOgogICAgICAgIHVzZXJuYW1lID0gZmxbImlkIl0ubG93ZXIoKQogICAgICAgIHBhc3N3b3JkID0gcHcubG93ZXIoKQogICAgICAgIHRyeToKICAgICAgICAgIGlmIHNlbGYuYnJ1dGVSZXF1ZXN0KHVzZXJuYW1lLCBwYXNzd29yZCkgPT0gVHJ1ZToKICAgICAgICAgICAgYnJlYWsKICAgICAgICBleGNlcHQ6CiAgICAgICAgICBjb250aW51ZQogICAgICAgIHByaW50KCgiXHJceDFiWzA7MzFtW1x4MWJbMDszN21DcmFja1x4MWJbMDszMW1dXHgxYlswOzM3bSAlcy8lcyBceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PSyA6ICVzXHgxYlswOzMybV0gXHgxYlswOzMxbVtceDFiWzA7MzdtS2FjaGktQ1AgOiAlc1x4MWJbMDszMW1dXHgxYlswOzM3bSIlKHNlbGYubG9vcCxsZW4oc2VsZi5mbCksbGVuKHNlbGYub2spLGxlbihzZWxmLmNwKSkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIGVsc2U6CiAgICAgIHNlbGYubG9vcCArPSAxCiAgICAgIGZvciBwdyBpbiBzZWxmLnNldHB3OgogICAgICAgIHVzZXJuYW1lID0gdXNlcnNbImlkIl0ubG93ZXIoKQogICAgICAgIHBhc3N3b3JkID0gcHcubG93ZXIoKQogICAgICAgIHRyeToKICAgICAgICAgIGlmIHNlbGYuYnJ1dGVSZXF1ZXN0KHVzZXJuYW1lLCBwYXNzd29yZCkgPT0gVHJ1ZToKICAgICAgICAgICAgYnJlYWsKICAgICAgICBleGNlcHQ6CiAgICAgICAgICBjb250aW51ZQogICAgICAgIHByaW50KCgiXHJceDFiWzA7MzFtW1x4MWJbMDszN21DcmFja1x4MWJbMDszMW1dXHgxYlswOzM3bSAlcy8lcyBceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PSyA6ICVzXHgxYlswOzMybV0gXHgxYlswOzMxbVtceDFiWzA7MzdtS2FjaGktQ1AgOiAlc1x4MWJbMDszMW1dXHgxYlswOzM3bSIlKHNlbGYubG9vcCxsZW4oc2VsZi5mbCksbGVuKHNlbGYub2spLGxlbihzZWxmLmNwKSkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKCmNsYXNzIGJhcGl0dGw6CiAgZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CiAgICBzZWxmLnNldHB3ID0gRmFsc2UKICAgIHNlbGYub2sgPSBbXQogICAgc2VsZi5jcCA9IFtdCiAgICBzZWxmLmxvb3AgPSAwCiAgICBzZWxmLmtyYWgoaXNpZmlsZSkKICBkZWYga3JhaChzZWxmLGlzaWZpbGUpOgogICAgcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgV2l0aCBQYXNzIERlZmF1bHQvTWFudWFsIFtkL21dIikpCiAgICB3aGlsZSBUcnVlOgogICAgICBmPWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIENob29zZSA6ICIpCiAgICAgIGlmIGYgaW5bIiIsIiAiXToKICAgICAgICBwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIEludmFsaWQgTnVtYmVyIikpCiAgICAgICAgY29udGludWUKICAgICAgZWxpZiBmIGluWyJtIiwiTSJdOgogICAgICAgIHRyeToKICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICBzZWxmLmFwaz1pc2lmaWxlCiAgICAgICAgICAgICAgc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgJXMiJWUpKQogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICBzZWxmLmZsPVtdCiAgICAgICAgICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXhhbXBsZSA6IDIyMzM0NCwzMzQ0NTUsMTIzNDU2IikpCiAgICAgICAgICBzZWxmLnB3PWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFBhc3N3b3JkIExpc3QgOiAiKS5zcGxpdCgiLCIpCiAgICAgICAgICBpZiBsZW4oc2VsZi5wdykgPT0wOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgZm9yIGkgaW4gc2VsZi5mczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgIHNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIjw9PiIpWzBdLCJwdyI6c2VsZi5wd30pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgIHByaW50KCgiICAlcyIlZSkpCiAgICAgICAgICBjb250aW51ZQogICAgICAgIHByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIENyYWNrIFN0YXJ0ZWQuLi4iK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktT0tdIFNhdmVkIHRvIDogS2FjaGktT0sudHh0IitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLUNQXSBTYXZlZCB0byA6IEthY2hpLUNQLnR4dFxuIikpCiAgICAgICAgVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYuYnJ1dGUsc2VsZi5mbCkKICAgICAgICAjb3MucmVtb3ZlKHNlbGYuYXBrKQogICAgICAgIGV4aXQoKQogICAgICAgIGJyZWFrCiAgICAgIGVsaWYgZiBpblsiZCIsIkQiXToKICAgICAgICB0cnk6CiAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgc2VsZi5hcGs9aXNpZmlsZQogICAgICAgICAgICAgIHNlbGYuZnM9b3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICBwcmludChlKQogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICBzZWxmLmZsPVtdCiAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpnZW5lcmF0ZShpLnNwbGl0KCI8PT4iKVsxXSl9KQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICBjb250aW51ZQogICAgICAgIHByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIENyYWNrIFN0YXJ0ZWQuLi4iK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktT0tdIFNhdmVkIHRvIDogS2FjaGktT0sudHh0IitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLUNQXSBTYXZlZCB0byA6IEthY2hpLUNQLnR4dFxuIikpCiAgICAgICAgVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYuYnJ1dGUsc2VsZi5mbCkKICAgICAgICBvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgZXhpdCgpCiAgICAgICAgYnJlYWsKICBkZWYgYnJ1dGVSZXF1ZXN0KHNlbGYsIHVzZXJuYW1lLCBwYXNzd29yZCk6CiAgICBnbG9iYWwgb2ssY3AsdHRsCiAgICBwYXJhbXMgPSB7ImFjY2Vzc190b2tlbiI6ICIzNTA2ODU1MzE3MjglN0M2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMiIsICAiZm9ybWF0IjogIkpTT04iLCAic2RrX3ZlcnNpb24iOiAiMiIsICJlbWFpbCI6IHVzZXJuYW1lLCAibG9jYWxlIjogImVuX1VTIiwgInBhc3N3b3JkIjogcGFzc3dvcmQsICJzZGsiOiAiaW9zIiwgImdlbmVyYXRlX3Nlc3Npb25fY29va2llcyI6ICIxIiwgInNpZyI6ICIzZjU1NWY5OWZiNjFmY2Q3YWEwYzQ0ZjU4ZjUyMmVmNiJ9CiAgICBhcGkgPSAiaHR0cHM6Ly9iLWFwaS5mYWNlYm9vay5jb20vbWV0aG9kL2F1dGgubG9naW4iCiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChhcGksIHBhcmFtcz1wYXJhbXMpCiAgICBpZiByZS5zZWFyY2goIihFQUFBKVxcdysiLCByZXNwb25zZS50ZXh0KToKICAgICAgc2VsZi5vay5hcHBlbmQodXNlcm5hbWUgKyAiIOKAoiAiICsgcGFzc3dvcmQpCiAgICAgIHByaW50KCgiXHJceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PS1x4MWJbMDszMm1dICVzIOKAoiAlcyAlcyAgICAgICAgICAgICAgICIlKHVzZXJuYW1lLHBhc3N3b3JkLE4pKSkKICAgICAgb2suYXBwZW5kKHVzZXJuYW1lICsgIiDigKIgIiArIHBhc3N3b3JkKQogICAgICBzYXZlID0gb3BlbigiS2FjaGktT0sudHh0IiwgImEiKQogICAgICBzYXZlLndyaXRlKHN0cih1c2VybmFtZSkgKyAiIOKAoiAiICsgc3RyKHBhc3N3b3JkKSArICJcbiIpCiAgICAgIHNhdmUuY2xvc2UoKQogICAgICByZXR1cm4gVHJ1ZQogICAgZWxzZToKICAgICAgaWYgInd3dy5mYWNlYm9vay5jb20iIGluIHJlc3BvbnNlLmpzb24oKVsiZXJyb3JfbXNnIl06CiAgICAgICAgdHJ5OgogICAgICAgICAga2U9cmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK3N0cih1c2VybmFtZSkrIj9hY2Nlc3NfdG9rZW49IitvcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpKQogICAgICAgICAgdHQ9anNvbi5sb2FkcyhrZS50ZXh0KQogICAgICAgICAgdHRsPXR0WyJiaXJ0aGRheSJdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICBzZWxmLmNwLmFwcGVuZCh1c2VybmFtZSArICIg4oCiICIgKyBwYXNzd29yZCArICIg4oCiICIgKyB0dGwpCiAgICAgICAgcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMxbV0gJXMg4oCiICVzIOKAoiAlc1x4MWJbMG0gICAiJSh1c2VybmFtZSxwYXNzd29yZCx0dGwpKSkKICAgICAgICBzYXZlID0gb3BlbigiS2FjaGktQ1AudHh0IiwgImErIikKICAgICAgICBzYXZlLndyaXRlKHN0cih1c2VybmFtZSkgKyAiIOKAoiAiICsgc3RyKHBhc3N3b3JkKSArICIg4oCiICIrIHN0cih0dGwpKyJcbiIpCiAgICAgICAgc2F2ZS5jbG9zZSgpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQogIGRlZiBicnV0ZShzZWxmLCBmbCk6CiAgICBpZiBzZWxmLnNldHB3ID09IEZhbHNlOgogICAgICBzZWxmLmxvb3AgKz0gMQogICAgICBmb3IgcHcgaW4gZmxbInB3Il06CiAgICAgICAgdXNlcm5hbWUgPSBmbFsiaWQiXS5sb3dlcigpCiAgICAgICAgcGFzc3dvcmQgPSBwdy5sb3dlcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgaWYgc2VsZi5icnV0ZVJlcXVlc3QodXNlcm5hbWUsIHBhc3N3b3JkKSA9PSBUcnVlOgogICAgICAgICAgICBicmVhawogICAgICAgIGV4Y2VwdDoKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUNyYWNrXHgxYlswOzMxbV1ceDFiWzA7MzdtICVzLyVzIFx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LIDogJXNceDFiWzA7MzJtXSBceDFiWzA7MzFtW1x4MWJbMDszN21LYWNoaS1DUCA6ICVzXHgxYlswOzMxbV1ceDFiWzA7MzdtIiUoc2VsZi5sb29wLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5vayksbGVuKHNlbGYuY3ApKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgZWxzZToKICAgICAgc2VsZi5sb29wICs9IDEKICAgICAgZm9yIHB3IGluIHNlbGYuc2V0cHc6CiAgICAgICAgdXNlcm5hbWUgPSB1c2Vyc1siaWQiXS5sb3dlcigpCiAgICAgICAgcGFzc3dvcmQgPSBwdy5sb3dlcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgaWYgc2VsZi5icnV0ZVJlcXVlc3QodXNlcm5hbWUsIHBhc3N3b3JkKSA9PSBUcnVlOgogICAgICAgICAgICBicmVhawogICAgICAgIGV4Y2VwdDoKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgcHJpbnQoKCJcclx4MWJbMDszMW1bXHgxYlswOzM3bUNyYWNrXHgxYlswOzMxbV1ceDFiWzA7MzdtICVzLyVzIFx4MWJbMDszMm1bXHgxYlswOzM3bUthY2hpLU9LIDogJXNceDFiWzA7MzJtXSBceDFiWzA7MzFtW1x4MWJbMDszN21LYWNoaS1DUCA6ICVzXHgxYlswOzMxbV1ceDFiWzA7MzdtIiUoc2VsZi5sb29wLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5vayksbGVuKHNlbGYuY3ApKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQoKIyMjIFJFU1VMVCAjIyMKCmRlZiByZXN1bHRzKERhcHVudGEsS3JhaGtyYWgpOgogICAgICAgIGlmIGxlbihEYXB1bnRhKSAhPTA6CiAgICAgICAgICAgICAgICBwcmludCgoIltPS10gOiAiK3N0cihsZW4oRGFwdW50YSkpKSkKICAgICAgICBpZiBsZW4oS3JhaGtyYWgpICE9MDoKICAgICAgICAgICAgICAgIHByaW50KCgiW0NQXSA6ICIrc3RyKGxlbihLcmFoa3JhaCkpKSkKICAgICAgICBpZiBsZW4oRGFwdW50YSkgPT0wIGFuZCBsZW4oS3JhaGtyYWgpID09MDoKICAgICAgICAgICAgICAgIHByaW50KCJcbiIpCiAgICAgICAgICAgICAgICBwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIE5vIFJlc3VsdCBGb3VuZCIpKQoKZGVmIHJlc3MoKToKICAgIG9zLnN5c3RlbSgiY2xlYXIiKQogICAgYmFubmVyKCkKICAgIHByaW50KChrKyJcblsgIitwKyJSZXN1bHQgQ3JhY2siK2srIiBdIitwKSkKICAgIHByaW50KChoKyJcblsgIitwKyJPSyIraCsiIF0iK3ApKQogICAgdHJ5OgogICAgICAgIG9zLnN5c3RlbSgiY2F0IEthY2hpLU9LLnR4dCIpCiAgICBleGNlcHQgSU9FcnJvcjoKICAgICAgICBwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIE5vIFJlc3VsdCBGb3VuZCIpKQogICAgcHJpbnQoKGsrIlxuWyAiK3ArIkNQIitrKyIgXSIrcCkpCiAgICB0cnk6CiAgICAgICAgb3Muc3lzdGVtKCJjYXQgS2FjaGktQ1AudHh0IikKICAgIGV4Y2VwdCBJT0Vycm9yOgogICAgICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgTm8gUmVzdWx0IEZvdW5kIikpCiAgICBpbnB1dChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkKICAgIG1lbnUoKQoKaWYgX19uYW1lX189PSJfX21haW5fXyI6Cglvcy5zeXN0ZW0oImdpdCBwdWxsIikKCWNvdW50cnkoKQ=="))